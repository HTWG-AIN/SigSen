%---------------
%╔═╗╔═╗╔╦╗╦ ╦╔═╗
%╚═╗║╣  ║ ║ ║╠═╝
%╚═╝╚═╝ ╩ ╚═╝╩  
%---------------
\documentclass[12pt,oneside,a4paper]{report}

% DOCUMENT SETUP
\usepackage[left=3cm, 
			right=2.5cm, 
			top=2.5cm, 
			bottom=2.5cm, 
			includehead, 
			includefoot]{geometry}

% line spacing
\usepackage{setspace}
\setstretch{1,25} % 15/12 --> 1.25

%de­fines Adobe Times Ro­man as de­fault text font
\usepackage{mathptmx}
\usepackage{times} % needed for acronym package

%PDF linking package
\usepackage[hidelinks]{hyperref}

% Language Setup
\usepackage[ngerman]{babel}
% language specific bibliography style
\usepackage[numbers]{natbib}
\usepackage[fixlanguage]{babelbib}
\selectbiblanguage{german}
% bliographystyle setup
% default style names: apalike alphadin ieeetr IEEEtranSN apalike2 alphadin 
% babel specific: babplain, babplai3, babalpha, babunsrt, bababbrv, bababbr3 unsrt 
\bibliographystyle{unsrturl}

% encoding setup
% T1 font encoding for languages that use a latin alphabet
\usepackage[T1]{fontenc} 

% enhanced input encoding handling - utf8 for äÄüÜöÖß...
\usepackage[utf8]{inputenc}
%\usepackage{ucs}%utf8x suppart

% after babel - set chapter string
\AtBeginDocument{\renewcommand{\chaptername}{}}

% enumeration
\usepackage{enumitem}
% tabular extension tabularx
\usepackage{tabularx}

% math packages
\usepackage{amsmath}
\usepackage{nicefrac}
\usepackage{amsthm}
\usepackage{amsbsy}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{MnSymbol}

% patches for latex
\usepackage{fixltx2e}

%special characters
\usepackage{amssymb}
\usepackage{upgreek,textgreek}

% acronym package
\usepackage[printonlyused, footnote]{acronym}

% breakable text in \seqsplit{}
\usepackage{seqsplit}

% \textmu
\usepackage{textcomp}

% package provides a way to compile sections of a document using the same preamble as the main document
\usepackage{subfiles}

% driver-independent color extension - used by listings,tabularx
\usepackage[usenames,dvipsnames,table,xcdraw]{xcolor}

% -- SYNTAX HIGHLIGHTING --
\usepackage{listings}
%\input{cfgs/listings/listings_def_lang_bash-cmd.tex} % adds style BASH_CMD
%\input{cfgs/listings/listings_def_lang_bash-script.tex} % adds style BASH_SCRIPT
\input{cfgs/listings/listings_def_lang_latex.tex} % adds style LATEX
%\input{cfgs/listings/listings_def_lang_matlab.tex} % adds style MATLAB
\input{cfgs/listings/listings_def_lang_python.tex} % adds style PYTHON
%\input{cfgs/listings/listings_def_lang_c++.tex} % adds style CPP
%\input{cfgs/listings/listings_def_lang_c.tex} % adds style C
%\input{cfgs/listings/listings_def_lang_json.tex} % adds style JSON

% HEADLINE CFG
\usepackage{fancyhdr} % Headers and footers
\usepackage{lastpage}
\usepackage{nopageno}
\setlength{\headheight}{1.5cm}
\pagestyle{fancy} % All pages have headers and footers
\fancyhead{} % Blank out the default header
\fancyfoot{} % Blank out the default footer
\fancyhead[L]{}
\fancyhead[C]{}
\fancyhead[R]{}
\fancyfoot[L]{}
\fancyfoot[C]{\thepage}
\fancyfoot[R]{}
% override plain page style for \part, \chapter or 
% \maketitle, which implicit specifies plain page style
\input{cfgs/fancyhdr/fancyhdr_pagestyle_plain.tex}
% set list pagestyle
\input{cfgs/fancyhdr/fancyhdr_pagestyle_lists.tex}

\renewcommand{\chaptermark}[1]{\markright{#1}{}}
\renewcommand{\sectionmark}[1]{\markright{#1}{}}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}

	
\usepackage{verbatim}
\usepackage{graphicx}
\usepackage{epstopdf}

% floating prevention packages
\usepackage{float}    % used with [H] positioning parameter
\usepackage{placeins} % \FloatBarrier 

% tikz packages
\usepackage{tikz}
\usepackage{caption}
\usepackage[list=true,listformat=simple]{subcaption}
\usepackage{standalone}
\usepackage{pgfplots}


% include only specified tex files - uncommend unneeded
\includeonly{preface/cover,
             preface/abstract,
             preface/tableofcontents,
             preface/listoffigures,
             preface/listoftables,
             preface/lstlistoflistings,
             appendix/bibliography}

%-------------------
%╔═╗╔╦╗╦═╗╦╔╗╔╔═╗╔═╗
%╚═╗ ║ ╠╦╝║║║║║ ╦╚═╗
%╚═╝ ╩ ╩╚═╩╝╚╝╚═╝╚═╝
%-------------------
\newcommand{\strLecture}{Signale, Systeme und Sensoren}
\newcommand{\strDate}{\today}
\newcommand{\strAuthorA}{M. Kieser}
\newcommand{\strAuthorB}{J. Altmeyer}
\newcommand{\strAuthorAEmail}{makieser@htwg-konstanz.de}
\newcommand{\strAuthorBEmail}{jualtmey@htwg-konstanz.de}
% Versuchsbeschreibung 
\newcommand{\strTopic}{Kalibrierung von Digitalkameras}
\newcommand{\strAbstract}{Dieser Versuch behandelt die Kalibrierung einer digitalen Kamera. }
% hyperref customization
\hypersetup{
	pdftitle    ={\strTopic}, % title
	pdfsubject	={\strLecture}, % subject of the document
	pdfauthor	={\strAuthorA, \strAuthorB}, % author
	pdfkeywords	={}, % list of keywords
	pdfcreator	={}, % creator of the document
	pdfproducer	={}, % producer of the document
	colorlinks=false, % false: boxed links; true: colored links
	linkcolor=red, % color of internal links (change box color with linkbordercolor)
    citecolor=green, % color of links to bibliography
    filecolor=magenta, % color of file links
    urlcolor=cyan, % color of external links
	%bookmarks=true, % show bookmarks bar?
	unicode=true, % non-Latin characters in Acrobat’s bookmarks
	pdftoolbar=true, % show Acrobat’s toolbar?
	pdfmenubar=true, % show Acrobat’s menu?
    pdffitwindow=false, % window fit to page when opened
	pdfnewwindow=true % links in new PDF window
}

%-----------------------------------------
% ╔╗ ╔═╗╔═╗╦╔╗╔  ╔╦╗╔═╗╔═╗╦ ╦╔╦╗╔═╗╔╗╔╔╦╗ 
% ╠╩╗║╣ ║ ╦║║║║   ║║║ ║║  ║ ║║║║║╣ ║║║ ║  
% ╚═╝╚═╝╚═╝╩╝╚╝  ═╩╝╚═╝╚═╝╚═╝╩ ╩╚═╝╝╚╝ ╩  
%-----------------------------------------

\begin{document}
\pagenumbering{Roman} 

%\setcounter{section}{0}
\include{preface/cover}

\include{preface/abstract}
\clearpage

%
% TABLE OF CONTENTS
%
\include{preface/tableofcontents}

%
% Abbildungsverzeichnis
%
\include{preface/listoffigures}

%
% Tabellenverzeichnis
%
\include{preface/listoftables}

%
% Listingverzeichnis
%
\include{preface/lstlistoflistings}


%--------------------------
% ╔═╗╦ ╦╔═╗╔═╗╔╦╗╔═╗╦═╗╔═╗ 
% ║  ╠═╣╠═╣╠═╝ ║ ║╣ ╠╦╝╚═╗ 
% ╚═╝╩ ╩╩ ╩╩   ╩ ╚═╝╩╚═╚═╝ 
%--------------------------

\pagenumbering{arabic} 
\setcounter{page}{1}
%
% CHAPTER Einleitung
%
\chapter{Einleitung}
\label{chap:EINL}
In diesem Versuch geht es um die Kalibrierung eines Kamerasensors einer Digitalkamera. Wie alle Sensoren sind auch Kamerasensoren einer gewissen Ungenauigkeit in ihrer Wiedergabe ausgesetzt. Dabei unterscheidet sich die Ungenauigkeit in einen systematischen und einen unsystematischen Fehler. Ersterer soll in der Kalibrierung mit Hilfe eines Dunkel- und Weißbildes eliminiert werden. Dabei ist das Dunkelbild für die Eliminierung des Dunkelstroms und das Weißbild für die Eliminierung der Vignettierung zuständig. Mithilfe dieser Beiden Momentaufnahmen lässt sich eine Kennlinie ermitteln, die uns eine korrigierte Bildwiedergabe ermöglicht. 
In den nachfolgenden Kapiteln werden wir uns nach folgender Reihenfolge bis zu einem korrigierten Bild heranarbeiten:

\begin{enumerate}
	\item Aufnahme und Analyse eines Graukeils
	\item Aufnahme eines Dunkelbildes zur Eliminierung von Störungen 	durch Dunkelstrom
	\item Aufnahme eines Weissbildes zur Eliminierung der Vignettierung
	\item Pixelfehler ermitteln und ein korrigiertes Graukeil Bild erzeugen
\end{enumerate}


%
% CHAPTER Versuch 1
%
\chapter{Versuch 1 - Aufnahme und Analyse eines Grauwertkeiles}
\label{chap:VERSUCH_1}
Im nachfolgenden Versuch wird mit Hilfe einer Webcam ein stufenförmiger Grauwertverlauf aufgenommen. Jede Grauwertstufe wird für sich erfasst und  dessen Grauwert ermittelt. Zur Korrektur von fehlerhaften Daten werden der Mittelwert und die Standardabweichung verwendet. 

\section{Fragestellung, Messprinzip, Aufbau, Messmittel}
\label{chap:VERSUCH_1_FRAGESTELLUNG}
Zu fragen ist nach dem jeweiligen gemittelten Grauwert einer Helligkeits-Stufe. Sensorrauschen der Kamera wird aber leichte Abweichungen von einem konstanten Wert bewirken.  Die Intensität dieses Abweichens werden wir in der jeweiligen Standardabweichung betrachten.\\
Das \textit{Messprinzip und Aufbau•} bilden sich aus einer Grauwertkeil mit verschieden hellen Grauwerten, einer Kamera die in gleichbleibender Entfernung (31cm) den Grauwertkeil bei gleichbleibenden Lichtverhältnissen aufnimmt. Die Belichtungsparameter der Kamera sind dabei Helligkeit: 45, Kontrast: 21, Sättigung: 0, Verstärkung: 35, Belichtung -3, Weissabgleich: 0.\\
\textit{Messmittel} ist der Sensor, welcher in der Kamera eingebaut ist und die unterschiedliche Helligkeit, die einfällt misst.

\section{Messwerte}
\label{chap:VERSUCH_1_MESSWERTE}
Es wurde ein Bild gemacht. (Siehe Abbildung \ref{fig:GRAUWERTKEIL})
Dieses Bild wurde in 5 Unterbilder unterteilt, zur Erfassung der Helligkeit pro Stufe. 

\begin{figure}[H]
	\centering\small
	\includegraphics[width=\textwidth]{src/Grauwertkeil.png}
	\caption{Aufgenommener Grauwertkeil}
	\label{fig:GRAUWERTKEIL}
\end{figure}



\section{Auswertung}
\label{chap:VERSUCH_1_AUSWERTUNG}
In der Tabelle \ref{tab:Unterbilder} wird der Mittelwert und die Standardabweichung pro Unterbild abgebildet. In Listing \ref{lst:CodeV2} ist der zugehörige Code in der Methode 'versuch1()' zu finden.

\begin{table}[H]
\begin{tabular}{ccc}
\hline
\textbf{Stufe} &\textbf{ Mittelwert} & \textbf{Standardabweichung} \\
\hline
Unterbild 1 & 34.41 & 3.76 \\
\hline
Unterbild 2 & 62.49 & 1.77 \\
\hline
Unterbild 3 & 104.33 & 1.42 \\
\hline
Unterbild 4 & 142.01 & 2.66 \\
\hline
Unterbild 5 & 157.00 & 0.07 \\
\hline
\end{tabular} 
\caption{Unterbilder mit Mittelwert und Standardabweichung}
\label{tab:Unterbilder}
\end{table}

\section{Interpretation}
\label{chap:VERSUCH_1_INTERPRETATION}
Bezüglich des Mittelwertes aus Tabelle \ref{tab:Unterbilder} ist zu sagen, dass für Unterbild1 welches das dunkelste Bild ist der niedrigste Helligkeitswert angegeben ist. Für das Unterbild5 ist der höchste Wert zu erkennen. Bei einer möglichen Bandbreite von 0-255 Helligkeitsstufen ist die Aufnahme als kontrastarm zu interpretieren.
Bezüglich der Standardabweichung ist besonders das dunkle Unterbild1 mit einem hohen Abweichungsfaktor von fast 4 Helligkeitspunkten zu erkennen.
Diese höhere Abweichung könnte aufgrund von kratzen aber auch vom Sensorrauschen selbst sein. In der Abbildung \ref{fig:GRAUWERTKEIL} sind hellere Linien im Bild zu erkennen, die zu einer stärkeren Streuung des Helligkeitswertes beitragen.

%
% CHAPTER Versuch 2
%
\chapter{Versuch 2 - Aufnahme eines Dunkelbildes}
\label{chap:VERSUCH_2}
Nachfolgend wird ein Dunkelbild erzeugt, zur Eliminierung von Störgrößen in der Aufnahme, die z.B. durch Dunkelstrom verursacht werden.

\section{Fragestellung, Messprinzip, Aufbau, Messmittel}
\label{chap:VERSUCH_2_FRAGESTELLUNG}
Wie sieht ein passendes Dunkelbild zu dem Versuchsaufbau aus Versuch \ref{chap:VERSUCH_1} aus? Dabei wird thermisches Rauschen durch mehrere Messungen (10 Stück) und deren Mittlung eliminiert.\\
Messprinzip und Messmittel sind gleich zu Versuch \ref{chap:VERSUCH_1}.
Zu beachten ist bezüglich Aufbau, dass von den \textbf{gleichen} Belichtungsparametern und Entfernung der Kamera auszugehen ist.

\section{Messwerte}
\label{chap:VERSUCH_2_MESSWERTE}
Es wurden 10 Dunkelbilder aufgenommen und mit dem Mittelwert zu dem Bild in Abbildung \ref{fig:DunkelBildMittel} zusammengefügt.

\begin{figure}[H]
	\centering\small
	\includegraphics[width=\textwidth]{src/DunkelbildContrastMax.png}
	\caption{gemitteltes und kontrastmaximiertes Dunkelbild}
	\label{fig:DunkelBildMittel}
\end{figure}

\section{Auswertung}
\label{chap:VERSUCH_2_AUSWERTUNG}
Es wird der Mittelwert aus 10 Dunkelbildern pro Bildpunkt ermittelt und so ein Bild von Mittelwerten erstellt.
In Listing \ref{lst:CodeV2} ist der zugehörige Code in der Methode 'versuch2()' zu finden.

\section{Interpretation}
\label{chap:VERSUCH_2_INTERPRETATION}
Aufgrund der Bauart der Webkamera, dass besonders geringe Helligkeitswerte automatisch auf Null gesetzt werden, konnte die Ermittlung des Dunkelbildes nicht erfasst werden. Somit kommt es zu keiner Korrektur des Graukeils in den folgenden Versuchen durch das Dunkelbild. Es wird aber dennoch, aus theoretischen Sicht, mit dem Dunkelbild weitergearbeitet.\\
Desweiteren sind auch keine hot- oder stuckpixels aus den Werten zu erkennen.

%
% CHAPTER Versuch 3
%
\chapter{Versuch 3 - Aufnahme eines Weißbildes}
\label{chap:VERSUCH_3}

In diesem Versuch wird ein Weißbild mit der Kamera aufgenommen, um die unterschiedlichen Sensitivitäten der einzelnen Pixel herausrechnen zu können.

\section{Fragestellung, Messprinzip, Aufbau, Messmittel}
\label{chap:VERSUCH_3_FRAGESTELLUNG}

Mit dem Dunkelbild aus Versuch 2 lassen sich nun alle Nullpunkte von jedem Pixel des Sensors bestimmen. Die Kennlinie jedes Pixels ist dadurch aber noch nicht gefunden.
Alle Pixel unterscheiden sich nämlich in ihrer Sensitivität aufgrund von Fertigungstoleranzen. Zudem wird die Helligkeit nicht gleichmäßig über die Optik der Kamera auf den Sensor übertragen (Vignettierung), wodurch abgedunkelte Bereiche auf dem Bild entstehen können. Um dies zu kompensieren, wird ein Weißbild benötigt. Mit einer Division durch das Weißbild können später die verschiedenen Sensitivitäten der Pixel herausgerechnet werden.
\paragraph{}
Versuchsaufbau ist der Selbe wie in den vorherigen Versuchen. Für die Aufnahme des Weißbildes wird ein leeres Blatt Papier verwendet.

\section{Messwerte}
\label{chap:VERSUCH_3_MESSWERTE}

Es wurden zehn Weißbilder mit der Kamera aufgenommen. Diese sind hier jedoch nicht aufgeführt, da sie einzeln nicht von Bedeutung sind.
Abbildung \ref{fig:WEISSBILD} zeigt das finale Weißbild kontrastmaximiert.
 
\begin{figure}
\centering\small
\includegraphics[scale=0.6]{src/WeissbildContrastMax.png}
\caption{Kontrastmaximiertes Weißbild}
\label{fig:WEISSBILD}
\end{figure}

\section{Auswertung}
\label{chap:VERSUCH_3_AUSWERTUNG}

Um das thermische Rauschen zu eliminieren, wird der Mittelwert von den zehn aufgenommenen Weißbildern berechnet. Von diesem gemittelten Weißbild wird noch das Dunkelbild subtrahiert.
Dadurch erhalten wir unser finales Weißbild. Abbildung \ref{fig:WEISSBILD} stellt dieses Weißbild kontrastmaximiert dar. Die Umsetzung in Python ist in Listing \ref{chap:APPENDIX_SOURCECODE_V1} in der Methode "versuch3()"  nachvollziehbar.

\section{Interpretation}
\label{chap:VERSUCH_3_INTERPRETATION}

In Abbildung \ref{fig:WEISSBILD} ist sehr schön die Vignettierung zu sehen. Am rechten Bildrand und teilweise in der unteren linken Ecke sind abgedunkelte Stellen zu erkennen.
%
% CHAPTER Versuch 4
%
\chapter{Versuch 4 - Pixelfehler}
\label{chap:VERSUCH_4}

In diesem Versuch wird überprüft, ob der Bildsensor fehlerhafte Pixel besitzt.
Zudem wird das Bild des Grauwertkeils mittels Weiß- und Dunkelbild korrigiert.

\section{Fragestellung, Messprinzip, Aufbau, Messmittel}
\label{chap:VERSUCH_4_FRAGESTELLUNG}

Ergibt sich eine Verbesserung des Bildes durch unsere Kalibrierung? Hat unser Bildsensor fehlerhafte Pixel? Um dies zu beantworten, wird das Dunkelbild auf Hot Pixels bzw. Stuck Pixels und das Weißbild auf Dead Pixels untersucht.
Des weiteren wird unser Grauwertkeil Bild aus Versuch 1 mit dem Programm \ref{chap:APPENDIX_SOURCECODE_V1} korrigiert.

\section{Messwerte}
\label{chap:VERSUCH_4_MESSWERTE}

Folgend sind die Mittelwerte und Standardabweichungen der Unterbilder des Grauwertkeils nach der Korrektur, sowie ein Vergleich der beiden Grauwertkeil Bilder dargestellt.

\begin{table}[H]
\centering 
\begin{tabular}{ccc}
\hline
\textbf{Stufe} &\textbf{ Mittelwert} & \textbf{Standardabweichung} \\
\hline
Unterbild 1 & 34.19 & 3.72 \\
\hline
Unterbild 2 & 62.09 & 1.75 \\
\hline
Unterbild 3 & 103.67 & 1.40 \\
\hline
Unterbild 4 & 141.97 & 1.95 \\
\hline
Unterbild 5 & 162.44 & 3.12 \\
\hline
\end{tabular} 
\caption{Unterbilder des Grauwertkeils nach der Korrektur}
\label{tab:UNTERBILDER_KOR}
\end{table}

\begin{figure}
\centering\small
\includegraphics[scale=0.6]{src/Grauwertkeil.png}
\caption{Ursprüngliches Grauwertkeil Bild}
\label{fig:GRAUWERT}
\centering\small
\includegraphics[scale=0.6]{src/KorrigierterGrauwertkeil.png}
\caption{Korrigiertes Grauwertkeil Bild}
\label{fig:GRAUWERT_KOR}
\end{figure}

\section{Auswertung}
\label{chap:VERSUCH_4_AUSWERTUNG}

Mit Hilfe des Dunkel- und Weißbildes haben wir nun die Kennlinie für alle Pixel des Sensors gefunden. Unser Bild des Grauwertkeils kann dadurch korrigiert werden. Dazu wird von dem aufgenommenen Bild zuerst das Dunkelbild subtrahiert. Danach wird es durch das Weißbild dividiert und wir erhalten das korrigierte Grauwertkeil Bild (Abbildung \ref{fig:GRAUWERT_KOR}). Siehe dazu auch Listing \ref{chap:APPENDIX_SOURCECODE_V1} die Funktion "versuch4()".

\section{Interpretation}
\label{chap:VERSUCH_4_INTERPRETATION}

In dem Dunkelbild (Abbildung \ref{fig:DunkelBildMittel}) und dem Weißbild (Abbildung \ref{fig:WEISSBILD}) sind keine fehlerhaften Pixel zu erkennen, weder ein Dead Pixel im Weißbild noch ein Stuck oder Hot Pixel im Dunkelbild.

\paragraph{}
Das korrigierte Grauwertkeil Bild (Abbildung \ref{fig:GRAUWERT_KOR}) unterscheidet sich nur sehr gering von dem ursprünglichen Bild (Abbildung \ref{fig:GRAUWERT}). Bei genauem Hinsehen ist zu erkennen, dass das korrigierte Bild am rechten Bildrand etwas heller ist als das Original. Dies spiegelt sich auch beim Vergleich der beiden Tabellen \ref{tab:UNTERBILDER_KOR} und \ref{tab:Unterbilder} wieder. Der Mittelwert des Unterbildes 5, also die Graustufe ganz rechts im Bild, ist größer geworden, d.h. die Helligkeit ist gestiegen.
Dies war zu Erwarten, da wir in Versuch 3 in diesem Bereich eine deutliche Vignettierung festgestellt haben. Alle anderen Werte sind nahezu gleich geblieben.
%
% CHAPTER Anhang
%
\renewcommand\thesection{A.\arabic{section}}
\renewcommand\thesubsection{\thesection.\arabic{subsection}}

\chapter*{Anhang}
\label{chap:APPENDIX}
\addcontentsline{toc}{chapter}{Anhang}
%\setcounter{chapter}{0}
\addtocounter{chapter}{1}
\setcounter{section}{0}

\section{Quellcode}
\label{chap:APPENDIX_SOURCECODE}

\subsection{Quellcode für Versuche 1 - 4}
\label{chap:APPENDIX_SOURCECODE_V1}
\begin{lstlisting}[style=PYTHON, frame=single, caption=QuellCodeV1 bis V4, captionpos=b, label=lst:CodeV2]
# -*- coding: utf-8 -*-
"""
Created on Mon Nov  9 15:07:39 2015
@author: Julian Altmeyer, Marcel Kieser
"""

import numpy as np
import cv2

def getSubImages(pic):
    image1 = pic[:,0:70]
    image2 = pic[:,90:230]
    image3 = pic[:,250:390]
    image4 = pic[:,410:550]
    image5 = pic[:,570:640]
    return image1, image2, image3, image4, image5


def getMeanStd(img):
    return np.mean(img), np.std(img)


def getTableLatex(table):
    strTab = ""
    for i in range(len(table)):
        strTab += "Unterbild " + str(i+1) + \
                  " & {0:.2f} & {1:.2f} \\\\\n\\hline\n".format(table[i][0],  table[i][1])

    print(strTab)

def maxContrast(img):
    maxValue = np.max(img)
    minValue = np.min(img)
    newImage = np.copy(img)
    
    for y in range(newImage.shape[0]):
        for x in range(newImage.shape[1]):
            if (maxValue - minValue) != 0:
                newImage[y][x] = (img[y][x] - minValue) * (255.0 / (maxValue - minValue))
            else:
                newImage[y][x] = 0
    return newImage


def versuch1():
    grayImg = cv2.imread("Grauwertkeil.png")    
    grayImg = cv2.cvtColor(grayImg, cv2.COLOR_BGR2GRAY)
    sliceAndTableImg(grayImg)

def sliceAndTableImg(image):    
    img1, img2, img3, img4, img5 = getSubImages(image)
    
    table = []
    table.append(getMeanStd(img1))
    table.append(getMeanStd(img2))
    table.append(getMeanStd(img3))
    table.append(getMeanStd(img4))
    table.append(getMeanStd(img5))
    
    getTableLatex(table)


def versuch2():
    dunkelbild = maxContrast(getDunkelbild())
    cv2.imwrite("DunkelbildContrastMax.png", dunkelbild)

def versuch3():
    weissbild = maxContrast(removeOffset(getWeissbild()))
    cv2.imwrite("WeissbildContrastMax.png", weissbild)
        

def versuch4():
    grayImg = cv2.imread("Grauwertkeil.png")
    grayImg = cv2.cvtColor(grayImg, cv2.COLOR_BGR2GRAY)
    dunkelbild = getDunkelbild()
    weissbild = getWeissbild()
    correctImg = correctImage(grayImg, weissbild, dunkelbild)
    cv2.imwrite("KorrigierterGrauwertkeil.png", correctImg)
    sliceAndTableImg(correctImg)

def correctImage(img, weisb, dunkelb):
    a = img - dunkelb
    a = a / normiereWeissbild(weisb)
    return a    
    
def normiereWeissbild(weissbild):
    w = np.double(weissbild)
    w = np.divide(w, np.mean(w))
    return w

def getWeissbild():
    weissbilder = []
    #erzeuge meanImage    
    for i in range(10):
        weissbilder.append(cv2.imread("Weissbilder/Weissbild" + str(i) + ".png"))
    
    meanImage = np.zeros((480, 640), dtype=int)

    for weissbild in weissbilder:
        wbild = cv2.cvtColor(weissbild, cv2.COLOR_BGR2GRAY)
        meanImage += wbild
        
    meanImage = meanImage / len(weissbilder)
    return meanImage

def getDunkelbild():
    dunkelbilder = []
    #erzeuge meanImage    
    for i in range(10):
        dunkelbilder.append(cv2.imread("Dunkelbilder/Dunkelbild" + str(i) + ".png"))

    meanImage = np.zeros((480, 640), dtype=int)

    for dunkelbild in dunkelbilder:
        dbild = cv2.cvtColor(dunkelbild, cv2.COLOR_BGR2GRAY)
        meanImage += dbild     
    
    meanImage = meanImage / len(dunkelbilder)
    return meanImage
    
def removeOffset(eingabebild):
    return eingabebild - getDunkelbild()

def main():
    versuch1()
    versuch2()
    versuch3()
    versuch4() 

if __name__ == "__main__":
    main()

    
\end{lstlisting}

%\section{Messergebnisse}
%\label{chap:APPENDIX_MEASUREMENT_SOURCE}

%
% Literaturverzeichnis
%
\include{appendix/bibliography}

\end{document}
%------------------------------------
% ╔═╗╔╗╔╔╦╗  ╔╦╗╔═╗╔═╗╦ ╦╔╦╗╔═╗╔╗╔╔╦╗
% ║╣ ║║║ ║║   ║║║ ║║  ║ ║║║║║╣ ║║║ ║ 
% ╚═╝╝╚╝═╩╝  ═╩╝╚═╝╚═╝╚═╝╩ ╩╚═╝╝╚╝ ╩ 
%------------------------------------