%---------------
%╔═╗╔═╗╔╦╗╦ ╦╔═╗
%╚═╗║╣  ║ ║ ║╠═╝
%╚═╝╚═╝ ╩ ╚═╝╩  
%---------------
\documentclass[12pt,oneside,a4paper]{report}

% DOCUMENT SETUP
\usepackage[left=3cm, 
			right=2.5cm, 
			top=2.5cm, 
			bottom=2.5cm, 
			includehead, 
			includefoot]{geometry}

% line spacing
\usepackage{setspace}
\setstretch{1,25} % 15/12 --> 1.25

%de­fines Adobe Times Ro­man as de­fault text font
\usepackage{mathptmx}
\usepackage{times} % needed for acronym package

%PDF linking package
\usepackage[hidelinks]{hyperref}

% Language Setup
\usepackage[ngerman]{babel}
% language specific bibliography style
\usepackage[numbers]{natbib}
\usepackage[fixlanguage]{babelbib}
\selectbiblanguage{german}
% bliographystyle setup
% default style names: apalike alphadin ieeetr IEEEtranSN apalike2 alphadin 
% babel specific: babplain, babplai3, babalpha, babunsrt, bababbrv, bababbr3 unsrt 
\bibliographystyle{unsrturl}

% encoding setup
% T1 font encoding for languages that use a latin alphabet
\usepackage[T1]{fontenc} 

% enhanced input encoding handling - utf8 for äÄüÜöÖß...
\usepackage[utf8]{inputenc}
%\usepackage{ucs}%utf8x suppart

% after babel - set chapter string
\AtBeginDocument{\renewcommand{\chaptername}{}}

% enumeration
\usepackage{enumitem}
% tabular extension tabularx
\usepackage{tabularx}

% math packages
\usepackage{amsmath}
\usepackage{nicefrac}
\usepackage{amsthm}
\usepackage{amsbsy}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{MnSymbol}

% patches for latex
\usepackage{fixltx2e}

%special characters
\usepackage{amssymb}
\usepackage{upgreek,textgreek}

% acronym package
\usepackage[printonlyused, footnote]{acronym}

% breakable text in \seqsplit{}
\usepackage{seqsplit}

% \textmu
\usepackage{textcomp}

% package provides a way to compile sections of a document using the same preamble as the main document
\usepackage{subfiles}

% driver-independent color extension - used by listings,tabularx
\usepackage[usenames,dvipsnames,table,xcdraw]{xcolor}

% -- SYNTAX HIGHLIGHTING --
\usepackage{listings}
%\input{cfgs/listings/listings_def_lang_bash-cmd.tex} % adds style BASH_CMD
%\input{cfgs/listings/listings_def_lang_bash-script.tex} % adds style BASH_SCRIPT
\input{cfgs/listings/listings_def_lang_latex.tex} % adds style LATEX
%\input{cfgs/listings/listings_def_lang_matlab.tex} % adds style MATLAB
\input{cfgs/listings/listings_def_lang_python.tex} % adds style PYTHON
%\input{cfgs/listings/listings_def_lang_c++.tex} % adds style CPP
%\input{cfgs/listings/listings_def_lang_c.tex} % adds style C
%\input{cfgs/listings/listings_def_lang_json.tex} % adds style JSON

% HEADLINE CFG
\usepackage{fancyhdr} % Headers and footers
\usepackage{lastpage}
\usepackage{nopageno}
\setlength{\headheight}{1.5cm}
\pagestyle{fancy} % All pages have headers and footers
\fancyhead{} % Blank out the default header
\fancyfoot{} % Blank out the default footer
\fancyhead[L]{}
\fancyhead[C]{}
\fancyhead[R]{}
\fancyfoot[L]{}
\fancyfoot[C]{\thepage}
\fancyfoot[R]{}
% override plain page style for \part, \chapter or 
% \maketitle, which implicit specifies plain page style
\input{cfgs/fancyhdr/fancyhdr_pagestyle_plain.tex}
% set list pagestyle
\input{cfgs/fancyhdr/fancyhdr_pagestyle_lists.tex}

\renewcommand{\chaptermark}[1]{\markright{#1}{}}
\renewcommand{\sectionmark}[1]{\markright{#1}{}}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}

	
\usepackage{verbatim}
\usepackage{graphicx}
\usepackage{epstopdf}

% floating prevention packages
\usepackage{float}    % used with [H] positioning parameter
\usepackage{placeins} % \FloatBarrier 

% tikz packages
\usepackage{tikz}
\usepackage{caption}
\usepackage[list=true,listformat=simple]{subcaption}
\usepackage{standalone}
\usepackage{pgfplots}


% include only specified tex files - uncommend unneeded
\includeonly{preface/cover,
             preface/abstract,
             preface/tableofcontents,
             preface/listoffigures,
             preface/listoftables,
             preface/lstlistoflistings,
             appendix/bibliography}

%-------------------
%╔═╗╔╦╗╦═╗╦╔╗╔╔═╗╔═╗
%╚═╗ ║ ╠╦╝║║║║║ ╦╚═╗
%╚═╝ ╩ ╩╚═╩╝╚╝╚═╝╚═╝
%-------------------
\newcommand{\strLecture}{Signale, Systeme und Sensoren}
\newcommand{\strDate}{\today}
\newcommand{\strAuthorA}{J. Altmeyer}
\newcommand{\strAuthorB}{M. Kieser}
\newcommand{\strAuthorAEmail}{jualtmey@htwg-konstanz.de}
\newcommand{\strAuthorBEmail}{makieser@htwg-konstanz.de}
% Versuchsbeschreibung 
\newcommand{\strTopic}{VERSUCH NAME}
\newcommand{\strAbstract}{Zusammenfassung etwa 100 Worte.}
% hyperref customization
\hypersetup{
	pdftitle    ={\strTopic}, % title
	pdfsubject	={\strLecture}, % subject of the document
	pdfauthor	={\strAuthorA, \strAuthorB}, % author
	pdfkeywords	={}, % list of keywords
	pdfcreator	={}, % creator of the document
	pdfproducer	={}, % producer of the document
	colorlinks=false, % false: boxed links; true: colored links
	linkcolor=red, % color of internal links (change box color with linkbordercolor)
    citecolor=green, % color of links to bibliography
    filecolor=magenta, % color of file links
    urlcolor=cyan, % color of external links
	%bookmarks=true, % show bookmarks bar?
	unicode=true, % non-Latin characters in Acrobat’s bookmarks
	pdftoolbar=true, % show Acrobat’s toolbar?
	pdfmenubar=true, % show Acrobat’s menu?
    pdffitwindow=false, % window fit to page when opened
	pdfnewwindow=true % links in new PDF window
}

%-----------------------------------------
% ╔╗ ╔═╗╔═╗╦╔╗╔  ╔╦╗╔═╗╔═╗╦ ╦╔╦╗╔═╗╔╗╔╔╦╗ 
% ╠╩╗║╣ ║ ╦║║║║   ║║║ ║║  ║ ║║║║║╣ ║║║ ║  
% ╚═╝╚═╝╚═╝╩╝╚╝  ═╩╝╚═╝╚═╝╚═╝╩ ╩╚═╝╝╚╝ ╩  
%-----------------------------------------

\begin{document}
\pagenumbering{Roman} 

%\setcounter{section}{0}
\include{preface/cover}

\include{preface/abstract}
\clearpage

%
% TABLE OF CONTENTS
%
\include{preface/tableofcontents}

%
% Abbildungsverzeichnis
%
\include{preface/listoffigures}

%
% Tabellenverzeichnis
%
\include{preface/listoftables}

%
% Listingverzeichnis
%
\include{preface/lstlistoflistings}


%--------------------------
% ╔═╗╦ ╦╔═╗╔═╗╔╦╗╔═╗╦═╗╔═╗ 
% ║  ╠═╣╠═╣╠═╝ ║ ║╣ ╠╦╝╚═╗ 
% ╚═╝╩ ╩╩ ╩╩   ╩ ╚═╝╩╚═╚═╝ 
%--------------------------

\pagenumbering{arabic} 
\setcounter{page}{1}
%
% CHAPTER Einleitung
%
\chapter{Einleitung}
\label{chap:EINL}


%
% CHAPTER Versuch 1
%
\chapter{Versuch 1 - Genauigkeit der AD-Wandlung}
\label{chap:VERSUCH_1}

\section{Fragestellung, Messprinzip, Aufbau, Messmittel}
\label{chap:VERSUCH_1_FRAGESTELLUNG}

\section{Messwerte}
\label{chap:VERSUCH_1_MESSWERTE}



\section{Auswertung}
\label{chap:VERSUCH_1_AUSWERTUNG}
Bei einem Eingangsspannungsbereichs von -10 V bis 10V des 11-Bit-AD-Wandlers ergibt sich ein theoretischer Quantisierungsfehler von $\Delta U = 0,0098 V$

Standardabweichung:
Multimeter Philips Std s=0.02862533842594704
AD Wandler Std s=0.0029325756597230355

\section{Interpretation}
\label{chap:VERSUCH_1_INTERPRETATION}
Multimeter Philips:
Standardabweichung s= 30mV
Dies bedeutet, dass eine analoge Eingangsspannung in eine um $\pm30mV$ abweichende Ausgangsspannung gewandelt wird. Der folgende AD Wandler kann dies wesentlich genauer.

AD Wandler:
Standardabweichung s= 3mV
Dies bedeutet, dass eine analoge Eingangsspannung in eine um $\pm3mV$ abweichende Ausgangsspannung gewandelt wird.

Der theoretischer Quantisierungsfehler = 10mV beschreibt die Genauigkeit des AD-Wandlers. So kann der AD Wandler beispielsweise eine Eingangsspannung von 1mV nicht von 9mV unterscheiden.

Quantisierungsfehler ist schuld!!!!!!

%
% CHAPTER Versuch 2
%
\chapter{Versuch 2 - Genauigkeit der DA-Wandlung}
\label{chap:VERSUCH_2}


\section{Fragestellung, Messprinzip, Aufbau, Messmittel}
\label{chap:VERSUCH_2_FRAGESTELLUNG}

\section{Messwerte}
\label{chap:VERSUCH_2_MESSWERTE}


\section{Auswertung}
\label{chap:VERSUCH_2_AUSWERTUNG}
Bei einem Ausgangspannungsbereichs von 0V bis 5V des 10-Bit-DA-Wandlers ergibt sich ein theoretischer Quantisierungsfehler von $\Delta U = 0,0049 V$

\section{Interpretation}
\label{chap:VERSUCH_2_INTERPRETATION}
Der theoretischer Quantisierungsfehler = 5mV beschreibt die Genauigkeit des DA-Wandlers. So kann der DA Wandler beispielsweise eine Eingangsspannung von 1mV nicht von 5mV unterscheiden.

DA Wandler:
Standardabweichung s=28mV
Dies bedeutet, dass eine digitale Eingabewert in eine um $\pm28mV$ abweichende Ausgangsspannung gewandelt wird.

DA Wandler ist schuld!!!!!!!!!!!!!!!!!

%
% CHAPTER Versuch 3
%
\chapter{Versuch 3 - Zeitverhalten der DA-Wandlung}
\label{chap:VERSUCH_3}

\section{Fragestellung, Messprinzip, Aufbau, Messmittel}
\label{chap:VERSUCH_3_FRAGESTELLUNG}


\section{Messwerte}
\label{chap:VERSUCH_3_MESSWERTE}

\begin{figure}[H]
\centering\small
\includegraphics[width=\textwidth]{src/Sinus.png}
\caption{generierter Sinus}
\label{fig:SINUS}
\end{figure}

\begin{figure}[H]
\centering\small
\includegraphics[width=\textwidth]{src/Sinus_Ausschnitt.png}
\caption{Sinus Ausschnitt}
\label{fig:SINUS_A}
\end{figure}

\section{Auswertung}
\label{chap:VERSUCH_3_AUSWERTUNG}
Durch ablesen aus der Abbildung \ref{fig:SINUS_A} ergibt sich ein $\Delta t = 10ms$ 

\section{Interpretation}
\label{chap:VERSUCH_3_INTERPRETATION}
Somit ergibt sich ca. eine maximale Ausgabefrequenz von 100Hz


%
% CHAPTER Versuch 4
%
\chapter{Versuch 4 - Abtasttheorem}
\label{chap:VERSUCH_4}

\section{Fragestellung, Messprinzip, Aufbau, Messmittel}
\label{chap:VERSUCH_4_FRAGESTELLUNG}

\section{Messwerte}
\label{chap:VERSUCH_4_MESSWERTE}
Abtastfrequenz= 8000Hz

\begin{figure}[H]
\centering\small
\includegraphics[scale=0.4]{src/1000fft.png}
\caption{1000Hz FFT}
\label{fig:1000_FFT}
\end{figure}

\begin{figure}[H]
\centering\small
\includegraphics[scale=0.4]{src/2000fft.png}
\caption{2000Hz FFT}
\label{fig:2000_FFT}
\end{figure}

\begin{figure}[H]
\centering\small
\includegraphics[scale=0.4]{src/3000fft.png}
\caption{3000Hz FFT}
\label{fig:3000_FFT}
\end{figure}

\begin{figure}[H]
\centering\small
\includegraphics[scale=0.4]{src/4000fft.png}
\caption{4000Hz FFT}
\label{fig:4000_FFT}
\end{figure}

\begin{figure}[H]
\centering\small
\includegraphics[scale=0.4]{src/5000fft.png}
\caption{5000Hz FFT}
\label{fig:5000_FFT}
\end{figure}

\begin{figure}[H]
\centering\small
\includegraphics[scale=0.4]{src/6000fft.png}
\caption{6000Hz FFT}
\label{fig:6000_FFT}
\end{figure}

\begin{figure}[H]
\centering\small
\includegraphics[scale=0.4]{src/7000fft.png}
\caption{7000Hz FFT}
\label{fig:7000_FFT}
\end{figure}

\begin{figure}[H]
\centering\small
\includegraphics[scale=0.4]{src/8000fft.png}
\caption{8000Hz FFT}
\label{fig:8000_FFT}
\end{figure}


\section{Auswertung}
\label{chap:VERSUCH_4_AUSWERTUNG}
Bei obiger Abtastfrequenz ergibt sich eine Nyquist-Frequenz = 4000Hz.

\section{Interpretation}
\label{chap:VERSUCH_4_INTERPRETATION}
%
% CHAPTER Anhang
%
\renewcommand\thesection{A.\arabic{section}}
\renewcommand\thesubsection{\thesection.\arabic{subsection}}

\chapter*{Anhang}
\label{chap:APPENDIX}
\addcontentsline{toc}{chapter}{Anhang}
%\setcounter{chapter}{0}
\addtocounter{chapter}{1}
\setcounter{section}{0}

\section{Quellcode für Versuche 1 - 4}
\label{chap:APPENDIX_SOURCECODE}
\begin{lstlisting}[style=PYTHON, frame=single, caption=QuellCodeV1 bis V4, captionpos=b, label=lst:Code]

# -*- coding: utf-8 -*-
"""
Created on Mon Jan 11 14:15:07 2016

@author: edc07
"""


import numpy as np
import matplotlib.pyplot as plt

#import redlab as rl
#import time
#from TekTDS2000 import *


def versuch1():
    out(1)
    #print(str(get_input(4000, 8000)))
    print('fertig')


def versuch2():
    #print(str(np.mean(get_input(4000, 8000))))

    mult_array = np.array([0.103, 0.196, 0.2, 0.2, 0.194, 0.198, 0.199, 0.199, 0.2, 0.198])
    ad_array = np.array([0.015, 0.018, 0.013, 0.015, 0.016, 0.013, 0.012, 0.012, 0.014, 0.022])
    print("Multimeter Philips Std s={}".format(getStd(mult_array)))
    print("AD Wandler Std s={}".format(getStd(ad_array)))

def versuch3():
    da_array = np.array([0.011, 0.019, 0.027, 0.041, 0.049, 0.058, 0.072, 0.080, 0.090, 0.096])
    print("DA Wandler Std s={}".format(getStd(da_array)))

def versuch4():    
    for x in get_sin():
       out(x)
        time.sleep(0.01)
    
    save_input_oszi()
    print(getInputData('sinus.csv')[0])
    
    plotRecord(getInputData('sinus.csv'))


def versuch5():
    np.savetxt('8000.csv', rl.cbVInScan(0, 0, 0, 4000, 8000, 1))
    
    plotFFT(getInputData('1000.csv'), 8000,'1000fft.png')
    plotFFT(getInputData('2000.csv'), 8000,'2000fft.png')
    plotFFT(getInputData('3000.csv'), 8000,'3000fft.png')
    plotFFT(getInputData('4000.csv'), 8000,'4000fft.png')
    plotFFT(getInputData('5000.csv'), 8000,'5000fft.png')
    plotFFT(getInputData('6000.csv'), 8000,'6000fft.png')
    plotFFT(getInputData('7000.csv'), 8000,'7000fft.png')
    plotFFT(getInputData('8000.csv'), 8000,'8000fft.png')


def plotFFT(rec, sampleRate, filename=''):
    
    #fft
    # n = Anzahl der Schwingungen innerhalb der gesamten Signaldauer
    c = np.fft.fft(rec)
    n = np.abs(c)
    sampleTime = 1 / sampleRate
    
    count = np.arange(0, len(n))* (1 / (len(n) * sampleTime))
    
    # Anzahl der Schwingungen innerhalb der gesamten Signaldauer dargestellt
    dpi=75
    fig, axN = plt.subplots(figsize=(800/dpi,600/dpi), dpi=dpi)
    axN.plot(count[:],n[:], color = "blue", label=" Amplitudenspektrum ")
    # lässt X-Achse bei 0 beginnen
    axN.autoscale(enable=True, axis='x', tight=True)
    axN.legend(loc='upper right');
    axN.set_xlabel("Frequenz [Hz]")
    axN.set_ylabel("Amplitude")
    
    # als png abspeichern    
    if filename is not '':
        fig.savefig(filename, transparent=True, dpi=dpi)
    return


def getStd(e_array):
    return np.std(e_array)

def plotRecord(rec):
    myDpi = 75
    fig, ax = plt.subplots(figsize=(800/myDpi, 600/myDpi), dpi=myDpi)
    ax.autoscale(enable=True, axis='x', tight=True)
    ax.plot(rec[400:2100,0], rec[400:2100,1])
    ax.set_xlabel('Time [$s$]')
    ax.set_ylabel('Amplitude [$V$]')


def save_input_oszi():
    scope = TekTDS2000()

    x,y = scope.getData(1,1,2500)
    np.savetxt("sinus.csv" , np.transpose([x,y]), delimiter=",")


def getInputData(filename):
    return np.genfromtxt(filename, delimiter=',')


def get_input(number, samplerate):
    return rl.cbVInScan(0, 0, 0, number, samplerate, 1)


def out(voltage):
    rl.cbVOut(0, 0, 101, voltage)


def get_sin(fs=100):
    val = np.linspace(0, 2 * np.pi, fs)
    return np.sin(val) + 1


def main():
    versuch1()
    versuch2()
    versuch3()
    versuch4()
    versuch5()

if __name__ == '__main__':
    main()
\end{lstlisting}

\section{Messergebnisse}
\label{chap:APPENDIX_MEASUREMENT_SOURCE}

\begin{figure}[H]
\centering\small
\includegraphics[width=\textwidth]{src/2GenauigkeitsWerteAD.jpg}
\caption{Genauigkeitswerte der AD Wandlung}
\label{fig:AD_WERTE}
\end{figure}

\begin{figure}[H]
\centering\small
\includegraphics[width=\textwidth]{src/3GenauigkeitsWerteDA.jpg}
\caption{Genauigkeitswerte der DA Wandlung}
\label{fig:DA_WERTE}
\end{figure}

%
% Literaturverzeichnis
%
\include{appendix/bibliography}

\end{document}
%------------------------------------
% ╔═╗╔╗╔╔╦╗  ╔╦╗╔═╗╔═╗╦ ╦╔╦╗╔═╗╔╗╔╔╦╗
% ║╣ ║║║ ║║   ║║║ ║║  ║ ║║║║║╣ ║║║ ║ 
% ╚═╝╝╚╝═╩╝  ═╩╝╚═╝╚═╝╚═╝╩ ╩╚═╝╝╚╝ ╩ 
%------------------------------------